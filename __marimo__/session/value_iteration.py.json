{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.11"
  },
  "cells": [
    {
      "id": "Hbol",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "25b20a879c890180cc8d0ec19f23e05e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"value-iteration\">Value Iteration</h1>\n<span class=\"paragraph\">Value iteration is the first algorithm that is discussed in <a href=\"https://github.com/MathFoundationRL/Book-Mathematical-Foundation-of-Reinforcement-Learning\" rel=\"noopener noreferrer\" target=\"_blank\">Mathematical Foundations for Machine Learning</a> book. The algorithm goes like this:</span>\n<ul>\n<li>\n<span class=\"paragraph\">Initialization:</span>\n<ul>\n<li>Define the probability models <marimo-tex class=\"arithmatex\">||(p(r|s,a)||)</marimo-tex> and <marimo-tex class=\"arithmatex\">||(p(s'|s,a)||)</marimo-tex> for all state-action pairs <marimo-tex class=\"arithmatex\">||((s,a)||)</marimo-tex>.</li>\n<li>Set initial value <marimo-tex class=\"arithmatex\">||(v_0||)</marimo-tex> as <marimo-tex class=\"arithmatex\">||(0||)</marimo-tex> (or any arbitrary number, but for simplicity set to <marimo-tex class=\"arithmatex\">||(0||)</marimo-tex>).</li>\n</ul>\n</li>\n<li>Goal: Search for the optimal state value and an optimal policy for solving the Bellman optimality equation.</li>\n</ul>\n<span class=\"paragraph\">While <marimo-tex class=\"arithmatex\">||(v_k||)</marimo-tex> has not converged in the sense that <marimo-tex class=\"arithmatex\">||(|| v_k - v_{k -1} ||||)</marimo-tex> is greater than a predefined small threshold, for the <marimo-tex class=\"arithmatex\">||(k||)</marimo-tex>th iteration do:<br>\n&emsp;For every state <marimo-tex class=\"arithmatex\">||(s \\in S||)</marimo-tex> do<br>\n&emsp;&emsp;For every action <marimo-tex class=\"arithmatex\">||(a in A(s)||)</marimo-tex>, do<br>\n&emsp;&emsp;&emsp;q-value: <marimo-tex class=\"arithmatex\">||(q(s,a) = \\sum_{r} p(r|s,a) r + \\gamma \\sum_{s'} p(s'|s,a) v_{k}(s')||)</marimo-tex><br>\n&emsp;&emsp;Maximum q-value: <marimo-tex class=\"arithmatex\">||(a_k^*(s) = \\text{arg} \\underset{a}{\\text{max}} \\space q_{k}(s,a)||)</marimo-tex><br>\n&emsp;&emsp;Policy update: <marimo-tex class=\"arithmatex\">||(\\pi_{k+1}(a|s) = 1||)</marimo-tex> if <marimo-tex class=\"arithmatex\">||(a = a_{k}^{*}||)</marimo-tex> else <marimo-tex class=\"arithmatex\">||(0||)</marimo-tex><br>\n&emsp;&emsp;Value update: <marimo-tex class=\"arithmatex\">||(v_{k+1}(s) = \\underset{a}{max} \\space q_{k}(s,a)||)</marimo-tex></span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "7b5698cb9d923f9b8b08adb3929d4112",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"initialize-environment\">Initialize environment</h2></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "3355abca9a826200d77d3b4bda345268",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "cc2b242b87ce82d70af545b71faa62c3",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"search-for-optimal-value-and-optimal-policy\">Search for optimal value and optimal policy</h2></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "40746e9db8ab778afac7f8368dcb2a05",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "converged? |0.000000 - 1.000000| = 1.000000\nconverged? |1.000000 - 1.900000| = 0.900000\nconverged? |1.900000 - 2.710000| = 0.810000\nconverged? |2.710000 - 3.439000| = 0.729000\nconverged? |3.439000 - 4.095100| = 0.656100\nconverged? |4.095100 - 4.685590| = 0.590490\nconverged? |4.685590 - 5.217031| = 0.531441\nconverged? |5.217031 - 5.695328| = 0.478297\nconverged? |5.695328 - 6.125795| = 0.430467\nconverged? |6.125795 - 6.513216| = 0.387420\nconverged? |6.513216 - 6.861894| = 0.348678\nconverged? |6.861894 - 7.175705| = 0.313811\nconverged? |7.175705 - 7.458134| = 0.282430\nconverged? |7.458134 - 7.712321| = 0.254187\nconverged? |7.712321 - 7.941089| = 0.228768\nconverged? |7.941089 - 8.146980| = 0.205891\nconverged? |8.146980 - 8.332282| = 0.185302\nconverged? |8.332282 - 8.499054| = 0.166772\nconverged? |8.499054 - 8.649148| = 0.150095\nconverged? |8.649148 - 8.784233| = 0.135085\nconverged? |8.784233 - 8.905810| = 0.121577\nconverged? |8.905810 - 9.015229| = 0.109419\nconverged? |9.015229 - 9.113706| = 0.098477\nconverged? |9.113706 - 9.202336| = 0.088629\nconverged? |9.202336 - 9.282102| = 0.079766\nconverged? |9.282102 - 9.353892| = 0.071790\nconverged? |9.353892 - 9.418503| = 0.064611\nconverged? |9.418503 - 9.476652| = 0.058150\nconverged? |9.476652 - 9.528987| = 0.052335\nconverged? |9.528987 - 9.576088| = 0.047101\nconverged? |9.576088 - 9.618480| = 0.042391\nconverged? |9.618480 - 9.656632| = 0.038152\nconverged? |9.656632 - 9.690968| = 0.034337\nconverged? |9.690968 - 9.721872| = 0.030903\nconverged? |9.721872 - 9.749684| = 0.027813\nconverged? |9.749684 - 9.774716| = 0.025032\nconverged? |9.774716 - 9.797244| = 0.022528\nconverged? |9.797244 - 9.817520| = 0.020276\nconverged? |9.817520 - 9.835768| = 0.018248\nconverged? |9.835768 - 9.852191| = 0.016423\nconverged? |9.852191 - 9.866972| = 0.014781\nconverged? |9.866972 - 9.880275| = 0.013303\nconverged? |9.880275 - 9.892247| = 0.011973\nconverged? |9.892247 - 9.903023| = 0.010775\nconverged? |9.903023 - 9.912720| = 0.009698\nconverged? |9.912720 - 9.921448| = 0.008728\nconverged? |9.921448 - 9.929303| = 0.007855\nconverged? |9.929303 - 9.936373| = 0.007070\nconverged? |9.936373 - 9.942736| = 0.006363\nconverged? |9.942736 - 9.948462| = 0.005726\nconverged? |9.948462 - 9.953616| = 0.005154\nconverged? |9.953616 - 9.958254| = 0.004638\nconverged? |9.958254 - 9.962429| = 0.004175\nconverged? |9.962429 - 9.966186| = 0.003757\nconverged? |9.966186 - 9.969567| = 0.003381\nconverged? |9.969567 - 9.972611| = 0.003043\nconverged? |9.972611 - 9.975350| = 0.002739\nconverged? |9.975350 - 9.977815| = 0.002465\nconverged? |9.977815 - 9.980033| = 0.002219\nconverged? |9.980033 - 9.982030| = 0.001997\nconverged? |9.982030 - 9.983827| = 0.001797\nconverged? |9.983827 - 9.985444| = 0.001617\nconverged? |9.985444 - 9.986900| = 0.001456\nconverged? |9.986900 - 9.988210| = 0.001310\nconverged? |9.988210 - 9.989389| = 0.001179\nconverged? |9.989389 - 9.990450| = 0.001061\nconverged? |9.990450 - 9.991405| = 0.000955\nconverged? |9.991405 - 9.992264| = 0.000860\nconverged? |9.992264 - 9.993038| = 0.000774\nconverged? |9.993038 - 9.993734| = 0.000696\nconverged? |9.993734 - 9.994361| = 0.000627\nconverged? |9.994361 - 9.994925| = 0.000564\nconverged? |9.994925 - 9.995432| = 0.000508\nconverged? |9.995432 - 9.995889| = 0.000457\nconverged? |9.995889 - 9.996300| = 0.000411\nconverged? |9.996300 - 9.996670| = 0.000370\nconverged? |9.996670 - 9.997003| = 0.000333\nconverged? |9.997003 - 9.997303| = 0.000300\nconverged? |9.997303 - 9.997573| = 0.000270\nconverged? |9.997573 - 9.997815| = 0.000243\nconverged? |9.997815 - 9.998034| = 0.000218\nconverged? |9.998034 - 9.998230| = 0.000197\nconverged? |9.998230 - 9.998407| = 0.000177\nconverged? |9.998407 - 9.998567| = 0.000159\nconverged? |9.998567 - 9.998710| = 0.000143\nconverged? |9.998710 - 9.998839| = 0.000129\nconverged? |9.998839 - 9.998955| = 0.000116\nconverged? |9.998955 - 9.999060| = 0.000104\nconverged? |9.999060 - 9.999154| = 0.000094\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Xref",
      "code_hash": "8ce4b16b22b58894aa86c421e8759df3",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>88</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "7694f4a66316e53c8cdd9d9954bd611d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>array([[7.09915359, 7.99915359, 8.99915359, 7.09915359, 8.09915359],\n       [7.99915359, 7.99915359, 9.99915359, 8.09915359, 7.99915359],\n       [8.09915359, 9.99915359, 7.99915359, 7.99915359, 8.99915359],\n       [7.99915359, 7.99915359, 7.99915359, 8.99915359, 9.99915359]])</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "3fa9b8846cf2acdd19f9cca87c99ce89",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>array([[[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]],\n\n       [[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]],\n\n       [[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]],\n\n       ...,\n\n       [[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]],\n\n       [[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]],\n\n       [[0., 0., 0., 0.],\n        [0., 0., 1., 0.],\n        [1., 1., 0., 0.],\n        [0., 0., 0., 0.],\n        [0., 0., 0., 1.]]], shape=(89, 5, 4))</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "e6319e3d180e96d572859e6ccedcf722",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>array([[[0.        , 1.        ],\n        [1.        , 1.        ]],\n\n       [[0.9       , 1.9       ],\n        [1.9       , 1.9       ]],\n\n       [[1.71      , 2.71      ],\n        [2.71      , 2.71      ]],\n\n       [[2.439     , 3.439     ],\n        [3.439     , 3.439     ]],\n\n       [[3.0951    , 4.0951    ],\n        [4.0951    , 4.0951    ]],\n\n       [[3.68559   , 4.68559   ],\n        [4.68559   , 4.68559   ]],\n\n       [[4.217031  , 5.217031  ],\n        [5.217031  , 5.217031  ]],\n\n       [[4.6953279 , 5.6953279 ],\n        [5.6953279 , 5.6953279 ]],\n\n       [[5.12579511, 6.12579511],\n        [6.12579511, 6.12579511]],\n\n       [[5.5132156 , 6.5132156 ],\n        [6.5132156 , 6.5132156 ]],\n\n       [[5.86189404, 6.86189404],\n        [6.86189404, 6.86189404]],\n\n       [[6.17570464, 7.17570464],\n        [7.17570464, 7.17570464]],\n\n       [[6.45813417, 7.45813417],\n        [7.45813417, 7.45813417]],\n\n       [[6.71232075, 7.71232075],\n        [7.71232075, 7.71232075]],\n\n       [[6.94108868, 7.94108868],\n        [7.94108868, 7.94108868]],\n\n       [[7.14697981, 8.14697981],\n        [8.14697981, 8.14697981]],\n\n       [[7.33228183, 8.33228183],\n        [8.33228183, 8.33228183]],\n\n       [[7.49905365, 8.49905365],\n        [8.49905365, 8.49905365]],\n\n       [[7.64914828, 8.64914828],\n        [8.64914828, 8.64914828]],\n\n       [[7.78423345, 8.78423345],\n        [8.78423345, 8.78423345]],\n\n       [[7.90581011, 8.90581011],\n        [8.90581011, 8.90581011]],\n\n       [[8.0152291 , 9.0152291 ],\n        [9.0152291 , 9.0152291 ]],\n\n       [[8.11370619, 9.11370619],\n        [9.11370619, 9.11370619]],\n\n       [[8.20233557, 9.20233557],\n        [9.20233557, 9.20233557]],\n\n       [[8.28210201, 9.28210201],\n        [9.28210201, 9.28210201]],\n\n       [[8.35389181, 9.35389181],\n        [9.35389181, 9.35389181]],\n\n       [[8.41850263, 9.41850263],\n        [9.41850263, 9.41850263]],\n\n       [[8.47665237, 9.47665237],\n        [9.47665237, 9.47665237]],\n\n       [[8.52898713, 9.52898713],\n        [9.52898713, 9.52898713]],\n\n       [[8.57608842, 9.57608842],\n        [9.57608842, 9.57608842]],\n\n       [[8.61847958, 9.61847958],\n        [9.61847958, 9.61847958]],\n\n       [[8.65663162, 9.65663162],\n        [9.65663162, 9.65663162]],\n\n       [[8.69096846, 9.69096846],\n        [9.69096846, 9.69096846]],\n\n       [[8.72187161, 9.72187161],\n        [9.72187161, 9.72187161]],\n\n       [[8.74968445, 9.74968445],\n        [9.74968445, 9.74968445]],\n\n       [[8.774716  , 9.774716  ],\n        [9.774716  , 9.774716  ]],\n\n       [[8.7972444 , 9.7972444 ],\n        [9.7972444 , 9.7972444 ]],\n\n       [[8.81751996, 9.81751996],\n        [9.81751996, 9.81751996]],\n\n       [[8.83576797, 9.83576797],\n        [9.83576797, 9.83576797]],\n\n       [[8.85219117, 9.85219117],\n        [9.85219117, 9.85219117]],\n\n       [[8.86697205, 9.86697205],\n        [9.86697205, 9.86697205]],\n\n       [[8.88027485, 9.88027485],\n        [9.88027485, 9.88027485]],\n\n       [[8.89224736, 9.89224736],\n        [9.89224736, 9.89224736]],\n\n       [[8.90302263, 9.90302263],\n        [9.90302263, 9.90302263]],\n\n       [[8.91272036, 9.91272036],\n        [9.91272036, 9.91272036]],\n\n       [[8.92144833, 9.92144833],\n        [9.92144833, 9.92144833]],\n\n       [[8.9293035 , 9.9293035 ],\n        [9.9293035 , 9.9293035 ]],\n\n       [[8.93637315, 9.93637315],\n        [9.93637315, 9.93637315]],\n\n       [[8.94273583, 9.94273583],\n        [9.94273583, 9.94273583]],\n\n       [[8.94846225, 9.94846225],\n        [9.94846225, 9.94846225]],\n\n       [[8.95361602, 9.95361602],\n        [9.95361602, 9.95361602]],\n\n       [[8.95825442, 9.95825442],\n        [9.95825442, 9.95825442]],\n\n       [[8.96242898, 9.96242898],\n        [9.96242898, 9.96242898]],\n\n       [[8.96618608, 9.96618608],\n        [9.96618608, 9.96618608]],\n\n       [[8.96956747, 9.96956747],\n        [9.96956747, 9.96956747]],\n\n       [[8.97261073, 9.97261073],\n        [9.97261073, 9.97261073]],\n\n       [[8.97534965, 9.97534965],\n        [9.97534965, 9.97534965]],\n\n       [[8.97781469, 9.97781469],\n        [9.97781469, 9.97781469]],\n\n       [[8.98003322, 9.98003322],\n        [9.98003322, 9.98003322]],\n\n       [[8.9820299 , 9.9820299 ],\n        [9.9820299 , 9.9820299 ]],\n\n       [[8.98382691, 9.98382691],\n        [9.98382691, 9.98382691]],\n\n       [[8.98544422, 9.98544422],\n        [9.98544422, 9.98544422]],\n\n       [[8.98689979, 9.98689979],\n        [9.98689979, 9.98689979]],\n\n       [[8.98820982, 9.98820982],\n        [9.98820982, 9.98820982]],\n\n       [[8.98938883, 9.98938883],\n        [9.98938883, 9.98938883]],\n\n       [[8.99044995, 9.99044995],\n        [9.99044995, 9.99044995]],\n\n       [[8.99140496, 9.99140496],\n        [9.99140496, 9.99140496]],\n\n       [[8.99226446, 9.99226446],\n        [9.99226446, 9.99226446]],\n\n       [[8.99303801, 9.99303801],\n        [9.99303801, 9.99303801]],\n\n       [[8.99373421, 9.99373421],\n        [9.99373421, 9.99373421]],\n\n       [[8.99436079, 9.99436079],\n        [9.99436079, 9.99436079]],\n\n       [[8.99492471, 9.99492471],\n        [9.99492471, 9.99492471]],\n\n       [[8.99543224, 9.99543224],\n        [9.99543224, 9.99543224]],\n\n       [[8.99588902, 9.99588902],\n        [9.99588902, 9.99588902]],\n\n       [[8.99630012, 9.99630012],\n        [9.99630012, 9.99630012]],\n\n       [[8.9966701 , 9.9966701 ],\n        [9.9966701 , 9.9966701 ]],\n\n       [[8.99700309, 9.99700309],\n        [9.99700309, 9.99700309]],\n\n       [[8.99730278, 9.99730278],\n        [9.99730278, 9.99730278]],\n\n       [[8.99757251, 9.99757251],\n        [9.99757251, 9.99757251]],\n\n       [[8.99781525, 9.99781525],\n        [9.99781525, 9.99781525]],\n\n       [[8.99803373, 9.99803373],\n        [9.99803373, 9.99803373]],\n\n       [[8.99823036, 9.99823036],\n        [9.99823036, 9.99823036]],\n\n       [[8.99840732, 9.99840732],\n        [9.99840732, 9.99840732]],\n\n       [[8.99856659, 9.99856659],\n        [9.99856659, 9.99856659]],\n\n       [[8.99870993, 9.99870993],\n        [9.99870993, 9.99870993]],\n\n       [[8.99883894, 9.99883894],\n        [9.99883894, 9.99883894]],\n\n       [[8.99895504, 9.99895504],\n        [9.99895504, 9.99895504]],\n\n       [[8.99905954, 9.99905954],\n        [9.99905954, 9.99905954]],\n\n       [[8.99915359, 9.99915359],\n        [9.99915359, 9.99915359]]])</pre>"
          }
        }
      ],
      "console": []
    }
  ]
}